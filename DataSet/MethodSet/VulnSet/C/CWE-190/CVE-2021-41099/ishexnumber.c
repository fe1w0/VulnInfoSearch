 Return ASAP if there is no space left. */
    if (avail == 0) return s;

    /* Check 