class RoutingInBoundHandler extends SimpleChannelInboundHandler<io.micronaut.http.HttpRequest<?>> {
    public void channelInactive(ChannelHandlerContext ctx) throws Exception {
        super.channelInactive(ctx);
        if (ctx.channel().isWritable()) {
            ctx.flush();
        }
        NettyHttpRequest request = NettyHttpRequest.remove(ctx);
        if (request != null) {
            try {
                request.release();
            } finally {
                if (beanLocator instanceof ApplicationEventPublisher) {
                    ctx.executor().execute(() -> {
                        try {
                            ((ApplicationEventPublisher) beanLocator).publishEvent(
                                    new HttpRequestTerminatedEvent(
                                            request
                                    )
                            );
                        } catch (Exception e) {
                            if (LOG.isErrorEnabled()) {
                                LOG.error("Error publishing request terminated event: " + e.getMessage(), e);
                            }
                        }
                    });
                }
            }
        }
    }
}