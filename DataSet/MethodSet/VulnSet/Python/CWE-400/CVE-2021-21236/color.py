'Replace ``string`` representing a color by a RGBA tuple.\n\n    See http://www.w3.org/TR/SVG/types.html#DataTypeColor\n\n    '
if not string:
    return (0, 0, 0, 0)
string = string.strip().lower()
if string in COLORS:
    (r, g, b, a) = COLORS[string]
    return (r, g, b, a * opacity)
match = RGBA.search(string)
if match:
    (r, g, b, a) = tuple((float(i.strip(' %')) / 100 if '%' in i else float(i) / 255 for i in match.group(1).split(',')))
    return (r, g, b, a * 255 * opacity)
match = RGB.search(string)
if match:
    (r, g, b) = tuple((float(i.strip(' %')) / 100 if '%' in i else float(i) / 255 for i in match.group(1).split(',')))
    return (r, g, b, opacity)
match = HEX_RRGGBB.search(string)
if match:
    plain_color = tuple((int(value, 16) / 255 for value in (string[1:3], string[3:5], string[5:7])))
    return plain_color + (opacity,)
match = HEX_RGB.search(string)
if match:
    plain_color = tuple((int(value, 16) / 15 for value in (string[1], string[2], string[3])))
    return plain_color + (opacity,)
return (0, 0, 0, 1)