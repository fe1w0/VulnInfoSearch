TEST(Encoding, Generics) {
  MallocMessageBuilder message;
  auto root = message.initRoot<test::TestUseGenerics>();
  auto reader = root.asReader();

  initTestMessage(root.initBasic().initFoo());
  checkTestMessage(reader.getBasic().getFoo());

  initTestMessage(root.initInner().initFoo());
  checkTestMessage(reader.getInner().getFoo());

  root.initInner2().setBaz("foo");
  EXPECT_EQ("foo", reader.getInner2().getBaz());

  initTestMessage(root.getInner2().initInnerBound().initFoo());
  checkTestMessage(reader.getInner2().getInnerBound().getFoo());

  initTestMessage(root.getInner2().initInnerUnbound().getFoo().initAs<TestAllTypes>());
  checkTestMessage(reader.getInner2().getInnerUnbound().getFoo().getAs<TestAllTypes>());

  initTestMessage(root.initUnspecified().getFoo().initAs<TestAllTypes>());
  checkTestMessage(reader.getUnspecified().getFoo().getAs<TestAllTypes>());

  initTestMessage(root.initWrapper().initValue().initFoo());
  checkTestMessage(reader.getWrapper().getValue().getFoo());
}