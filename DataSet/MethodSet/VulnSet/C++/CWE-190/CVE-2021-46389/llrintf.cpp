 float scale = 1.0 / logf( max + 1.;