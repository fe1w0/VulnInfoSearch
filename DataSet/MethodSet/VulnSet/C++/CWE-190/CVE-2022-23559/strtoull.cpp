mension gets replaced by the embedding.
  const int output_rank = (lookup_ran