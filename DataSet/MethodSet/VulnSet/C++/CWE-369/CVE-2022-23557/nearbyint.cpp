
  // Ensure that each thread has KernelRows rows to process, if at all possible.
  int thread_count = std::min(max_num