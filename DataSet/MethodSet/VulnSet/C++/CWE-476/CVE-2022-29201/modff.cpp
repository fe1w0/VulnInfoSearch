d =
          std::min(patch_index