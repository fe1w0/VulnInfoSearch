ch based on device affinity and compute a
  // cost before a