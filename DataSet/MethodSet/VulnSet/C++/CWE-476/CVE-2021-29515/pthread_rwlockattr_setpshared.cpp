<= diag_index &&
                diag_index <= upper_diag_index) {
              output(batch, i, j) 