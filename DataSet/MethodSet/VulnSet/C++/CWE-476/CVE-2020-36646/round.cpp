    case 3:
                utf8chars[2] = 0x80 | (wc & 0x3f);
                wc = (wc >> 6) | 0x800;
                /* fallthrough */
            case 2:
                utf8chars[1] = 0x80 | (wc &