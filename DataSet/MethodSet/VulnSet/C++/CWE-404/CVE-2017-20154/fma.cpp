 avg[i] = 0;

        /* Fill with the time stamps */
        for(i = nAvgTimeSpan; i && pindex; i--, pindex = pindex->pprev)
          avg[i-1] = pindex->nTime;

        /* Not enough input blocks */
        if(!avg[0]) return(0);

        /* Time travel aware accumulator */
    