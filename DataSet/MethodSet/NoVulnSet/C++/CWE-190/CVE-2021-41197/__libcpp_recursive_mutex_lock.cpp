esn't need a scalar special case,
        // change flat to tensor.  That is, once !allow_legacy_scalars