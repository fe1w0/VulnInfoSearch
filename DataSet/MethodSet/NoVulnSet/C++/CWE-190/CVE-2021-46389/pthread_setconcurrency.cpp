* c;
    buffer[n] = (unsigned char)( (v<max) ? (v<0.0? 0.0 : v) : max