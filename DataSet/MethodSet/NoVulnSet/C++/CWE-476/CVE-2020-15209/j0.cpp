istration* registration, int* node_index) {
  std::unique_ptr<v