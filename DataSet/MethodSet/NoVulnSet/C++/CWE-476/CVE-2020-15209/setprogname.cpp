tep 3: Fill all data structures;