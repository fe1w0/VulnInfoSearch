 max_diag_len =
        std::min(num_rows + std::min(upper