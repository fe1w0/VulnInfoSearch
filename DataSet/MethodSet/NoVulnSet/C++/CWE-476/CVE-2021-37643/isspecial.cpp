   const TensorShape& diagonal_shape = diagonal.shape();
    const int diag_rank = di