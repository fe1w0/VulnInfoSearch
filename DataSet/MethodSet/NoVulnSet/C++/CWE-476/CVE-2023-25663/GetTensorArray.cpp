Status GetTensorArray(OpKernelContext* ctx, TensorArray** tensor_array) {
  string container;
  string ta_handle;
  if (ctx->input_dtype(0) != DT_RESOURCE) {
    TF_RETURN_IF_ERROR(GetHandle(ctx, &container, &ta_handle));
    ResourceMgr* rm = ctx->resource_manager();
    if (rm == nullptr) return errors::Internal("No resource manager.");
    ScopedStepContainer* sc = ctx->step_container();
    if (sc == nullptr) return errors::Internal("No step container.");
    TF_RETURN_IF_ERROR(sc->Lookup(rm, container + ta_handle, tensor_array));
    return OkStatus();
  } else {
    return LookupResource(ctx, HandleFromInput(ctx, 0), tensor_array);
  }
}