// batch dimension.
    // TODO(mrry): Investigate ways to avoid this unconditional check