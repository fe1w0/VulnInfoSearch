n can be very slow on Android. Can we
    // optimize this by keeping the scratch buffer around?
    // Because memory allocation is 