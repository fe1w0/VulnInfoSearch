public class EmbedServlet2 extends HttpServlet
{
	public static final long serialVersionUID = 1L;
	public static String SHAPES_PATH = "/shapes";
	public static String STENCIL_PATH = "/stencils";
	public static String lastModified = null;
	public static int MAX_FETCH_SIZE = 50 * 1024 * 1024; // 50 MB
	public HashMap<String, String> stencils = new HashMap<String, String>();
	public HashMap<String, String[]> libraries = new HashMap<String, String[]>();
	public void writeEmbedResponse(HttpServletRequest request,
			HttpServletResponse response) throws IOException
	{
		response.setCharacterEncoding("UTF-8");
		response.setContentType("application/javascript; charset=UTF-8");
		response.setHeader("Last-Modified", lastModified);
		
		if (request.getParameter("fetch") != null)
		{
			response.setHeader("Cache-Control", "no-store");
		}

		OutputStream out = response.getOutputStream();

		// Creates XML for stencils
		PrintWriter writer = new PrintWriter(out);

		// Writes JavaScript and adds function call with
		// stylesheet and stencils as arguments 
		writer.println(createEmbedJavaScript(request));
		response.setStatus(HttpServletResponse.SC_OK);

		writer.flush();
		writer.close();
	}
}