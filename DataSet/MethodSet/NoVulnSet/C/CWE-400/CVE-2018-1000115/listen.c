while (ch) {
        int todo = (len > ch->used