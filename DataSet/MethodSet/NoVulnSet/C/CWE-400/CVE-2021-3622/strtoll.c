locks) is
 * returned in 'blocks_ret'.
 *
 * -----------------------