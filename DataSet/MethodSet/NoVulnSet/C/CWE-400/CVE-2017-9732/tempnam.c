 {
		LOG(LOG_ERR, ("ridiculous length, %ld", len));
		goto bail;
	}

	if (!tmpbuf) {
		if ((tmpbuf = malloc(len)) == NULL) {
			LOG(LOG_CRIT, ("malloc failure, %ld bytes", len));
			goto bail;
		}
	}

	ret = timed_read(fd, tmpbuf + tmpbuf_pos, len - tmpbuf_pos, timeout);
	if (ret == -1) {

		if (errno == EINTR || errno == EAGAIN)
			return -2;

		LOG(LOG_ERR, 