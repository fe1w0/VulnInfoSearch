int decomp_get_rddata(js_string *compressed, js_string *out,
                      unsigned int compressed_offset, int type, int rdlength) {

    char *desc;
    int subtype, total, len;

    desc = decomp_get_rrdesc(type);

    if(desc == 0) { /* Unknown RR type */
        if(rdlength == 0) {
            return JS_SUCCESS;
            }
        if(decomp_append_bytes(compressed,out,compressed_offset,
                               rdlength) != JS_SUCCESS) {
            return JS_ERROR;
            }
        else {
            return JS_SUCCESS;
            }
        }
    else {
        subtype = *desc;
        total = 0;
        /* Handle the various types of data we can get in the RR RDDATA */
        while(subtype != 0) {
            /* Fix-length data fields */
            if(subtype > 0 && subtype < 64) {
                if(decomp_append_bytes(compressed,out,
                   compressed_offset,subtype) != JS_SUCCESS) {
                       return JS_ERROR;
                       }
                total += subtype;
                compressed_offset += subtype;
                }
            /* Dlabels (which may be compressed) */
            else if(subtype == RRSUB_DLABEL) {
                len = decomp_append_dlabel(compressed,out,
                        compressed_offset);
                if(len == JS_ERROR) {
                    return JS_ERROR;
                    }
                total += len;
                compressed_offset += len;
                }
            /* Text data fields */
            else if(subtype == RRSUB_TEXT) {
                /* Data abstraction violation */
                len = *(compressed->string + compressed_offset);
                len += 1; /* To account for the one byte which
                             describes the length */
                if(len < 0 || len > 256) {
                    return JS_ERROR;
                    }
                if(decomp_append_bytes(compressed,out,
                                       compressed_offset,len) !=
                   JS_SUCCESS) {
                    return JS_ERROR;
                    }
                total += len;
                compressed_offset += len;
                }
            /* Variable length data (length determined by rdlength) */
            else if(subtype == RRSUB_VARIABLE) {
                len = rdlength - total;
                if(len <= 0) {
                    break;
                    }
                if(decomp_append_bytes(compressed,out,
                                       compressed_offset,len) != JS_SUCCESS) {
                    return JS_ERROR;
                    }
                total += len;
                compressed_offset += len;
                }
            else { /* Should never happen */
                return JS_ERROR;
                }
            desc++;
            /* RRSUB_VARIABLE must be the last subtype */
            if(subtype != RRSUB_VARIABLE)
                subtype = *desc;
            else
                subtype = 0; /* break the loop */
            }
        /* Sanity check; make sure that rdlength panned out */
        if(rdlength != total) {
            return JS_ERROR;
            }
        }

    /* The record's rddata was sucessfully decompressed */
    return JS_SUCCESS;
    }