'\n        Test that uploading large files (spooled to the filesystem) work as expected\n        '
test_image_file = get_test_image_file()
uploaded_file = TemporaryUploadedFile('test.png', 'image/png', test_image_file.size, 'utf-8')
uploaded_file.write(test_image_file.file.getvalue())
uploaded_file.seek(0)
response = self.post({'title': 'Test image', 'file': uploaded_file})
self.assertRedirects(response, reverse('wagtailimages:index'))
images = Image.objects.filter(title='Test image')
self.assertEqual(images.count(), 1)
image = images.first()
self.assertEqual(image.width, 640)
self.assertEqual(image.height, 480)
self.assertTrue(image.file_size)
self.assertTrue(image.file_hash)
root_collection = Collection.get_first_root_node()
self.assertEqual(image.collection, root_collection)